#! /bin/bash

set -eu

# 查找sshd的路径
sshd_path=$(which sshd)

# 确认sshd_path是否为空
if [ -z "$sshd_path" ]; then
  echo "未找到sshd的路径，请确保sshd已安装并位于可执行路径中。"
  exit 1
fi

# 查找sshd使用的liblzma路径
path="$(ldd $sshd_path | grep liblzma | grep -o '/[^ ]*')"

# 判断路径是否存在
if [ -z "$path" ]; then
  echo "可能不容易受到攻击"
  exit
fi

# 检查函数签名
if hexdump -ve '1/1 "%.2x"' "$path" | grep -q f30f1efa554889f54c89ce5389fb81e7000000804883ec28488954241848894c2410; then
  echo "可能容易受到攻击"
else
  echo "可能不容易受到攻击"
fi

# 检查xz版本
xz_version=$(xz --version | head -n1 | awk '{print $4}')

# 判断版本是否为5.6.0或5.6.1
if [[ "$xz_version" == "5.6.0" || "$xz_version" == "5.6.1" ]]; then
  echo -e "\e[31m警告: xz版本为 $xz_version, 请注意可能的安全风险。\e[0m"
else
  echo "xz版本: $xz_version"
fi
